---
title: 部署
---
::: warning 提示
部署章节仅用于交接, 不提供示例代码
:::
IM项目的部署还是比较简单的, 不过为了减少重复性的工作, 我专门写了一个用于部署的脚本, 用于将打包好的项目放入指定文件夹. 脚本的路径为: im/build/deploy.ts  

## 特别说明
1. 脚本里需要配置的目录路径  
    - cdnUrl 用于放置js, css等静态资源的目录
    - webURL 用于放置入口文件的目录

2. 脚本里为什么将publicPath路径替换为变量?  
    为什么在部署时, 要将生成后的publicPath路径替换为变量呢? 原因如下:  
   
   - 部署后静态资源和入口文件**不在同一个子域名下**, 因此配置publicPath时, **生产模式不能使用相对路径**  
   - 后端有 开发/测试/线上 三个不同环境, **写死绝对路径也是行不通的**, 因此需要**写成一个变量**  
   - vue的publicPath在打包后, 生成的**是一个字符串, 不能为变量(?)**  
   
   由于以上原因, 所以在部署时, 需要将publicPath路径替换为变量

3. 为什么会部署失败?
   一般部署失败可能是: 
   - 目录配置不对(目录不存在, 请检查cdnUrl, webURL路径)
   - 每次部署前会文件比对, 上一次部署时修改publicPath路径后, js文件hash值改变, 本次部署会将其删除. 解决办法是再执行一次部署脚本

4. 不使用部署脚本时, 应该怎么将打包好的项目放进后端开发环境?
    1. 将入口文件的名称 index.html 改为 index.html.php, 然后放入后端指定的模板文件夹
    2. 将静态资源放入后端指定的静态资源文件夹
    3. 打包后所有包含 环境变量VUE_APP_CDN_URL值(比如//cdn.{ROOT_DOMAIN}/im/) 的文件, 将值替换为top.cdnUrl || appConfig.cdnUrl
    4. 打包后所有包含 环境变量VUE_APP_CDN_ROOT_URL值 的文件, 将值替换为top.cdnRootUrl || appConfig.cdnRootUrl

> 特别说明4中需要注意替换的顺序
